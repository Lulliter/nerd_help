<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Intro to building data pipelines in organizations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="02_data_pipelines_files/libs/clipboard/clipboard.min.js"></script>
<script src="02_data_pipelines_files/libs/quarto-html/quarto.js"></script>
<script src="02_data_pipelines_files/libs/quarto-html/popper.min.js"></script>
<script src="02_data_pipelines_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="02_data_pipelines_files/libs/quarto-html/anchor.min.js"></script>
<link href="02_data_pipelines_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="02_data_pipelines_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="02_data_pipelines_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="02_data_pipelines_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="02_data_pipelines_files/libs/bootstrap/bootstrap-c0367b04c37547644fece4185067e4a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Outline</h2>
   
  <ul>
  <li><a href="#reference" id="toc-reference" class="nav-link active" data-scroll-target="#reference">Reference</a></li>
  <li><a href="#entities" id="toc-entities" class="nav-link" data-scroll-target="#entities">Entities</a>
  <ul class="collapse">
  <li><a href="#american-companies" id="toc-american-companies" class="nav-link" data-scroll-target="#american-companies">American companies</a></li>
  <li><a href="#italian-companies" id="toc-italian-companies" class="nav-link" data-scroll-target="#italian-companies">Italian companies</a></li>
  <li><a href="#eu-companies" id="toc-eu-companies" class="nav-link" data-scroll-target="#eu-companies">EU companies</a></li>
  </ul></li>
  <li><a href="#topics-questions" id="toc-topics-questions" class="nav-link" data-scroll-target="#topics-questions">Topics / questions</a>
  <ul class="collapse">
  <li><a href="#economics-conceps-to-consider" id="toc-economics-conceps-to-consider" class="nav-link" data-scroll-target="#economics-conceps-to-consider">Economics’ conceps to consider</a></li>
  </ul></li>
  <li><a href="#general-principles-on-data-pipelines" id="toc-general-principles-on-data-pipelines" class="nav-link" data-scroll-target="#general-principles-on-data-pipelines">General principles on data pipelines</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section">—</a></li>
  <li><a href="#fondazioni-bancarie" id="toc-fondazioni-bancarie" class="nav-link" data-scroll-target="#fondazioni-bancarie">Fondazioni Bancarie</a>
  <ul class="collapse">
  <li><a href="#italian-companies-fondazioni" id="toc-italian-companies-fondazioni" class="nav-link" data-scroll-target="#italian-companies-fondazioni">Italian companies (fondazioni)</a></li>
  <li><a href="#data-use-by-foundations" id="toc-data-use-by-foundations" class="nav-link" data-scroll-target="#data-use-by-foundations">Data Use by Foundations</a></li>
  <li><a href="#bilancio-di-missione-cariparma-su-2024" id="toc-bilancio-di-missione-cariparma-su-2024" class="nav-link" data-scroll-target="#bilancio-di-missione-cariparma-su-2024">Bilancio di missione Cariparma su 2024</a></li>
  <li><a href="#questions-goals-for-foundations" id="toc-questions-goals-for-foundations" class="nav-link" data-scroll-target="#questions-goals-for-foundations">Questions &amp; Goals for foundations</a></li>
  <li><a href="#best-practice-in-foundations" id="toc-best-practice-in-foundations" class="nav-link" data-scroll-target="#best-practice-in-foundations">Best practice in foundations</a></li>
  </ul></li>
  <li><a href="#salary-range" id="toc-salary-range" class="nav-link" data-scroll-target="#salary-range">Salary range</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">—</a></li>
  <li><a href="#needed-skills" id="toc-needed-skills" class="nav-link" data-scroll-target="#needed-skills">Needed skills</a></li>
  <li><a href="#tools" id="toc-tools" class="nav-link" data-scroll-target="#tools">Tools</a></li>
  <li><a href="#regulatory-requirements" id="toc-regulatory-requirements" class="nav-link" data-scroll-target="#regulatory-requirements">Regulatory requirements</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Intro to building data pipelines in organizations</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Thu, 5 of June, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">Thu, 5 of June, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="reference" class="level1">
<h1>Reference</h1>
<ul>
<li>OSF support page <a href="https://help.osf.io/">https://help.osf.io/</a></li>
<li>OSF <a href="https://help.osf.io/article/576-tips-and-tricks">Tips and tricks</a> page</li>
<li>Prof.&nbsp;Pat Schloss’ Lab organization protocols:
<ul>
<li><a href="https://www.schlosslab.org/lab_business/schloss-data_shared_directory.html">Shloss lab’s data folder</a></li>
<li><a href="https://github.com/SchlossLab/new_projects">New Proj template in Github</a></li>
</ul></li>
<li>Daan Marchiori’s book on <a href="https://datasciworkflows.netlify.app/">R in production</a></li>
<li>Blog post on <a href="https://www.kdnuggets.com/2019/01/role-data-engineer-changing.html">Role of Data Engineer</a></li>
</ul>
</section>
<section id="entities" class="level1">
<h1>Entities</h1>
<ul>
<li>OSF</li>
<li>Atlan</li>
<li><a href="https://datapartnership.org/">Development Data Partnership</a></li>
<li>Posit, especially
<ul>
<li>Posit workbench, a platform for data science teams to collaborate and build data products</li>
<li>Posit Connect, a platform for sharing and deploying data products</li>
</ul></li>
</ul>
<section id="american-companies" class="level2">
<h2 class="anchored" data-anchor-id="american-companies">American companies</h2>
<ul>
<li><a href="https://www.jumpingrivers.com/">Jumping Rivers</a></li>
<li><a href="https://www.landeranalytics.com/">Lander Analytics</a></li>
</ul>
</section>
<section id="italian-companies" class="level2">
<h2 class="anchored" data-anchor-id="italian-companies">Italian companies</h2>
<ul>
<li><a href="https://www.miriade.it/it/consulenza-informatica">Miriade</a></li>
</ul>
</section>
<section id="eu-companies" class="level2">
<h2 class="anchored" data-anchor-id="eu-companies">EU companies</h2>
<ul>
<li>Appsilon, it has <a href="https://www.appsilon.com/services/sce">Statistical Computing Environemnt</a> for clinical teams</li>
</ul>
</section>
</section>
<section id="topics-questions" class="level1">
<h1>Topics / questions</h1>
<ul>
<li>privacy and regulations (by sector)
<ul>
<li>deidentification</li>
<li>anonymization</li>
</ul></li>
<li>data collection and storage
<ul>
<li>processes for ingesting, storing, and pre-processing data</li>
<li>metadata curation</li>
</ul></li>
<li>transforming data into insights<br>
</li>
<li>data governance
<ul>
<li>sharing and access</li>
<li>ethical use</li>
<li>licensing of derived analyses</li>
</ul></li>
<li>Theory of Change: a description of how and why a development intervention is expected to deliver desired results; details the causal flow of how and why changes will occur, as well as who must be involved, who has interests at stake, and what steps must be followed for intended results to be reached (Gertler et al.&nbsp;2016).</li>
</ul>
<section id="economics-conceps-to-consider" class="level2">
<h2 class="anchored" data-anchor-id="economics-conceps-to-consider">Economics’ conceps to consider</h2>
<p>Economists are always conscious of several fundamentals that must be understood in order to avoid making a mess of the world:</p>
<ul>
<li>incentives,</li>
<li>unintended consequences,</li>
<li>opportunity costs,</li>
<li>shadow prices,</li>
<li>relative prices,</li>
<li>relative supply and demand and</li>
<li>sunk costs (these last two can be broadly classified as understanding the word “marginal”).</li>
</ul>
</section>
</section>
<section id="general-principles-on-data-pipelines" class="level1">
<h1>General principles on data pipelines</h1>
<ul>
<li>Make sure your sensitive data is well protected.</li>
<li>Data Generating Methods Should Be As Open and Standard As Possible</li>
<li>Data Aggregation Standards Should Be As Clear As Possible</li>
<li>Ask the right questions before purchasing software.</li>
<li>Permanent solutions, visualizations and answers flows v. “Ad-hoc Report”
<ul>
<li><em>each AhR request delays the creation of more permanent solutions. The absence of those solutions, in turn, lead to more requests.</em> <span class="citation" data-cites="decision-first_ai_five_2017">(<a href="#ref-decision-first_ai_five_2017" role="doc-biblioref">Decision-First AI 2017</a>)</span></li>
</ul></li>
<li>Business Intelligence is not just interactive reporting, although that is a component. A great BI solution is a model of your business. It allows you to gain insights, track change, and forecast future outcomes. BI should include segmentation and benchmarks. It includes forecasting, scoring, and visualization. A good BI developer/designer needs broad knowledge and experience. <span class="citation" data-cites="decision-first_ai_ad-hoc_2016">(<a href="#ref-decision-first_ai_ad-hoc_2016" role="doc-biblioref">Decision-First AI 2016</a>)</span></li>
</ul>
</section>
<section id="section" class="level1">
<h1>—</h1>
</section>
<section id="fondazioni-bancarie" class="level1">
<h1>Fondazioni Bancarie</h1>
<p>Le Fondazioni di origine bancaria sono organizzazioni <strong>non profit, private e autonome</strong>, nate all’inizio degli anni Novanta dalla riforma del sistema del credito. Sono 85, differenti per dimensione e operatività territoriale, e intervengono in diversi campi dal welfare alla cultura, dall’innovazione all’ambiente, dall’educazione alla ricerca.</p>
<section id="italian-companies-fondazioni" class="level2">
<h2 class="anchored" data-anchor-id="italian-companies-fondazioni">Italian companies (fondazioni)</h2>
<ul>
<li>Fondazione Cariplo</li>
<li>Fondazione Cassa di Risparmio di Padova e Rovigo</li>
</ul>
</section>
<section id="data-use-by-foundations" class="level2">
<h2 class="anchored" data-anchor-id="data-use-by-foundations">Data Use by Foundations</h2>
<p>Foundations <strong>rely on data from NGOs</strong> to explain how donated money was spent, and to decide where to invest in the future. Foundations <strong>collect this data</strong> by asking questions and designing <em>grant parameters</em>, both of which keep NGOs accountable for their spending. To get better data from NGOs, foundations must ask better questions and build grant parameters that are achievable, work towards transparent results, and avoid tedious burdens on under-resourced NGOs. Though it can be difficult, improving data quality and the questions being asked is a win-win for all involved.</p>
</section>
<section id="bilancio-di-missione-cariparma-su-2024" class="level2">
<h2 class="anchored" data-anchor-id="bilancio-di-missione-cariparma-su-2024">Bilancio di missione Cariparma su 2024</h2>
<ul>
<li>Erogazioni deliberate (36 mln x 394 progetti accolti) e effettuate
<ul>
<li>51% a enti pubblici!?!?!</li>
</ul></li>
</ul>
</section>
<section id="questions-goals-for-foundations" class="level2">
<h2 class="anchored" data-anchor-id="questions-goals-for-foundations">Questions &amp; Goals for foundations</h2>
<blockquote class="blockquote">
<p>Io provengo da realta pubbliche ( addirittura multilaterali) dove mi sono resa conto che l’agenda e’ spesso dettata prima e altrove pero mi sembra che le fondazini siano di natura privata quindi…</p>
</blockquote>
<ul>
<li>A chi risponde la Fondazione? Cioè, quanta libertà ha la Fondazione di decidere a chi dare i fondi? + Cerca sinergie e/o complementarieta negli interventi con altri enti? (Comune, Universita, Camera di commercio enti del 3o settore?)</li>
</ul>
<blockquote class="blockquote">
<p>ho notato che il 41% dei progetti finanziati sono in enti pubblici del territorio</p>
</blockquote>
<ul>
<li><p>Is the issue measuring the impact of your existing projects, or rather being sure to target the right projects in the first place?</p>
<ul>
<li>How is proper targeting measured? Can predictive models be used to identify the most promising projects?</li>
<li>Can we use thematic mapping to overlap funding committed and the needs of the territory?</li>
</ul></li>
<li><p>La strategia di sviluppo degli strumenti erogativi tiene conto degli altri strumenti di finanziamento e delle altre iniziative di sviluppo del territorio, in modo da evitare sovrapposizioni e conflitti, e per massimizzare l’impatto delle risorse investite?</p>
<ul>
<li>azione diretta</li>
<li>azione di sistema</li>
</ul></li>
<li><p>Act as the hub in a network of foundations, NGOs, and other stakeholders to share data and insights.</p></li>
<li><p>Obiettivo non è necessariamente risolvere un problema (es Migranti) ma di sperimentare e consolidare alcune buone pratiche realizzate dal Privato sociale, che possano indicare al Pubblico possibili strade da percorrere, replicare ed estendere su scala più ampia.</p></li>
</ul>
</section>
<section id="best-practice-in-foundations" class="level2">
<h2 class="anchored" data-anchor-id="best-practice-in-foundations">Best practice in foundations</h2>
<ul>
<li>Fondazione Cariplo <a href="https://www.fondazionecariplo.it/it/la-fondazione/osservatorio-e-valutazione.html">Osservatorio e Valutazione</a> - dal 2006</li>
</ul>
</section>
</section>
<section id="salary-range" class="level1">
<h1>Salary range</h1>
<ul>
<li><p>quando si chiedono almeno 5 anni, di solito si parla di Sr.&nbsp;Data Analyst, e non di Data Analyst</p></li>
<li><p>Datapizza:</p>
<ul>
<li>Sr.&nbsp;Data Analyst, Italia
<ul>
<li><blockquote class="blockquote">
<p>6 anni esperienza – mediana (BASE) = 46k €/anno</p>
</blockquote></li>
</ul></li>
<li>Sr.&nbsp;Data Scientist, Italia
<ul>
<li><blockquote class="blockquote">
<p>6 anni esperienza – mediana (BASE) = 53k €/anno</p>
</blockquote></li>
</ul></li>
</ul></li>
<li><p>Glassdoor:</p>
<ul>
<li>Sr.&nbsp;Data Analyst, Italia
<ul>
<li>4-6 anni esperienza 33.000 € - 45.000 €/anno – media (BASE) = 40k €/anno</li>
<li>7-9 anni esperienza 37.000 € - 50.000 €/anno – media (BASE) = 43k €/anno</li>
<li>10-14 anni esperienza 37.000 € - 51.000 €/anno – media (BASE) = 46k €/anno</li>
<li><blockquote class="blockquote">
<p>15 anni esperienza 35.000 € - 80.500 €/anno – media (BASE) = 50k €/anno</p>
</blockquote></li>
</ul></li>
<li>Sr.&nbsp;Data Scientist, Italia
<ul>
<li>4-6 anni esperienza - media (BASE) = 45k €/anno</li>
<li>7-9 anni esperienza - media (BASE) = 50k €/anno</li>
<li>10-14 anni esperienza - media (BASE) = 540k €/anno</li>
<li><blockquote class="blockquote">
<p>15 anni esperienza - media (BASE) = 65k €/anno</p>
</blockquote></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="section-1" class="level1">
<h1>—</h1>
</section>
<section id="needed-skills" class="level1">
<h1>Needed skills</h1>
<ul>
<li>Running models on remote machines (cloud or on-premise)
<ul>
<li>SSH</li>
<li>the Basics of the Terminal will be extremely useful when working with remote machines</li>
<li>SSH and SCP - <code>SSH</code> is a command you can run from your terminal to connect to a remote machine. <code>SCP</code> is a command that will allow you to copy data from your local machine (such as your laptop) to your remote machine. Being data scientists, an easy way to move data between machines is very valuable.</li>
</ul></li>
</ul>
</section>
<section id="tools" class="level1">
<h1>Tools</h1>
<ul>
<li>Airtable ~ a cloud-based platform for creating and sharing relational databases. see <a href="https://medium.com/data-science/how-airtable-can-help-you-become-a-more-effective-data-scientist-2f0b1c7d8a3f">old blog</a></li>
<li>Docker ~ a lightweight virtual machine that allows you to run code in a containerized environment. see <a href="https://medium.com/data-science/how-docker-can-help-you-become-a-more-effective-data-scientist-7fc048ef91d5">old blog</a></li>
</ul>
</section>
<section id="regulatory-requirements" class="level1">
<h1>Regulatory requirements</h1>
<ul>
<li><p>Myth that open source software is not compliant with regulations (e.g., FDA, EMA, HIPAA, GDPR),</p></li>
<li><p>Open source solutions can have support too, e,g, in Pharma there are:</p>
<ul>
<li>R Validation Hub,</li>
<li>Pharmaverse, and</li>
<li>R Consortium</li>
</ul></li>
</ul>

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-decision-first_ai_ad-hoc_2016" class="csl-entry" role="listitem">
Decision-First AI. 2016. <span>“Ad-Hoc Reports <span>Anonymous</span>.”</span> Data Based. November 19, 2016. <a href="https://medium.com/corsair-s-business/ad-hoc-reports-anonymous-6f30a13fbb59">https://medium.com/corsair-s-business/ad-hoc-reports-anonymous-6f30a13fbb59</a>.
</div>
<div id="ref-decision-first_ai_five_2017" class="csl-entry" role="listitem">
———. 2017. <span>“Five <span>Areas Of Analytics That Can</span>’t <span>Be Optional</span>.”</span> Data Based. August 18, 2017. <a href="https://medium.com/corsair-s-business/five-areas-of-analytics-that-cant-be-optional-999c57e1434b">https://medium.com/corsair-s-business/five-areas-of-analytics-that-cant-be-optional-999c57e1434b</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>